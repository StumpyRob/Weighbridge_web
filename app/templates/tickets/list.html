{% extends "base.html" %}

{% block title %}Tickets | Weighbridge Web{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1>Tickets</h1>
    <p class="muted">Filter and review ticket activity.</p>
  </div>
  <div>
    <a class="button" href="/tickets/new">New Ticket</a>
  </div>
</div>

<form class="filters" method="get" action="/tickets">
  <div class="field">
    <label for="date_from">Date from</label>
    <input type="date" id="date_from" name="date_from" value="{{ filters.date_from }}" />
  </div>
  <div class="field">
    <label for="date_to">Date to</label>
    <input type="date" id="date_to" name="date_to" value="{{ filters.date_to }}" />
  </div>
  <div class="field">
    <label for="status">Status</label>
    <input type="text" id="status" name="status" value="{{ filters.status }}" />
  </div>
  <div class="field">
    <label for="direction">Direction</label>
    <input type="text" id="direction" name="direction" value="{{ filters.direction }}" />
  </div>
  <div class="field">
    <label for="transaction_type">Transaction type</label>
    <input
      type="text"
      id="transaction_type"
      name="transaction_type"
      value="{{ filters.transaction_type }}"
    />
  </div>
  <div class="field">
    <label for="customer">Customer</label>
    <input type="text" id="customer" name="customer" value="{{ filters.customer }}" />
  </div>
  <div class="field">
    <label for="vehicle">Vehicle reg contains</label>
    <input type="text" id="vehicle" name="vehicle" value="{{ filters.vehicle }}" />
  </div>
  <div class="field">
    <label for="ticket_no">Ticket no</label>
    <input type="text" id="ticket_no" name="ticket_no" value="{{ filters.ticket_no }}" />
  </div>
  <div class="actions">
    <button type="submit">Filter</button>
    <a class="link-button" href="/tickets">Reset</a>
  </div>
</form>

<div class="table-wrap">
  <table class="data-table">
    <thead>
      <tr>
        <th>Ticket no</th>
        <th>Date/time</th>
        <th>Direction</th>
        <th>Transaction</th>
        <th>Customer</th>
        <th>Vehicle</th>
        <th>Product</th>
        <th>Gross/Tare/Net</th>
        <th>Total</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
        <tr>
          <td><a href="/tickets/{{ row.Ticket.id }}">{{ row.Ticket.ticket_no }}</a></td>
          <td>{{ row.Ticket.datetime }}</td>
          <td>{{ row.Ticket.direction }}</td>
          <td>{{ row.Ticket.transaction_type }}</td>
          <td>{{ row.Customer.name if row.Customer else "" }}</td>
          <td>{{ row.Vehicle.registration if row.Vehicle else "" }}</td>
          <td>{{ row.Product.description if row.Product else "" }}</td>
          <td>
            {{ row.Ticket.gross_kg or "" }} /
            {{ row.Ticket.tare_kg or "" }} /
            {{ row.Ticket.net_kg or "" }}
          </td>
          <td>{{ row.Ticket.total or "" }}</td>
          <td>{{ row.Ticket.status }}</td>
        </tr>
      {% else %}
        <tr>
          <td colspan="10" class="empty">No tickets found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="pagination">
  <div class="muted">
    Page {{ page }} of {{ total_pages }} ({{ total_count }} tickets)
  </div>
  <div class="pager-links">
    {% if page > 1 %}
      <a href="/tickets?page={{ page - 1 }}">Previous</a>
    {% endif %}
    {% if page < total_pages %}
      <a href="/tickets?page={{ page + 1 }}">Next</a>
    {% endif %}
  </div>
</div>
{% endblock %}
